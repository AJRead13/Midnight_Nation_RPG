# Midnight Nation RPG - Deployment Guide

## Prerequisites
- GitHub account
- MongoDB Atlas account (free tier)
- Render.com account (free tier)
- (Optional) Email service account (Gmail, SendGrid, or AWS SES)

---

## Step 1: MongoDB Atlas Setup

### 1.1 Create MongoDB Atlas Cluster
1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas/register)
2. Sign up or log in
3. Click "Create" to create a new cluster
4. Choose **FREE** tier (M0 Sandbox)
5. Select a cloud provider and region (closest to you)
6. Name your cluster (e.g., "midnight-nation-cluster")
7. Click "Create Cluster" (takes ~3-5 minutes)

### 1.2 Configure Database Access
1. Go to "Database Access" in the left sidebar
2. Click "Add New Database User"
3. Choose "Password" authentication
4. Create username and password (save these securely!)
5. Set privileges to "Atlas Admin" or "Read and Write to any database"
6. Click "Add User"

### 1.3 Configure Network Access
1. Go to "Network Access" in the left sidebar
2. Click "Add IP Address"
3. Click "Allow Access from Anywhere" (0.0.0.0/0)
   - This is needed for Render to connect
   - In production, you can restrict this to specific IPs
4. Click "Confirm"

### 1.4 Get Connection String
1. Go to "Database" in the left sidebar
2. Click "Connect" on your cluster
3. Choose "Connect your application"
4. Select "Node.js" driver version 4.1 or later
5. Copy the connection string (looks like: `mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/`)
6. Replace `<username>` and `<password>` with your actual credentials
7. Add database name at the end: `mongodb+srv://user:pass@cluster0.xxxxx.mongodb.net/midnight_nation_rpg`

### 1.5 Seed the Database
After deployment, you'll need to run the seed script to populate reference data:
```bash
# This will be done via Render shell or locally connected to Atlas
```

---

## Step 2: Render.com Setup

### 2.1 Connect GitHub Repository
1. Go to [Render.com](https://render.com/)
2. Sign up or log in (use GitHub OAuth)
3. Click "New +" → "Blueprint"
4. Connect your GitHub account
5. Select your repository: `AJRead13/Midnight_Nation_RPG`
6. Render will detect `render.yaml` automatically

### 2.2 Configure Environment Variables

#### For Backend Service (midnight-nation-api):
```
NODE_ENV=production
MONGODB_URI=mongodb+srv://user:pass@cluster0.xxxxx.mongodb.net/midnight_nation_rpg
JWT_SECRET=[auto-generated by Render or create strong random string]
JWT_EXPIRE=7d
CLIENT_URL=[Your frontend URL from Render, e.g., https://midnight-nation-client.onrender.com]
EMAIL_HOST=[optional: smtp.gmail.com or smtp.sendgrid.net]
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=[optional: your email or API key]
EMAIL_PASS=[optional: your password or API key]
EMAIL_FROM=Midnight Nation RPG <noreply@midnightnation.com>
```

#### For Frontend Service (midnight-nation-client):
```
VITE_API_URL=[Your backend URL from Render, e.g., https://midnight-nation-api.onrender.com]
```

### 2.3 Deploy
1. Click "Apply" to create services
2. Render will automatically build and deploy both services
3. Wait for builds to complete (~5-10 minutes)
4. Note both URLs provided by Render

### 2.4 Update Environment Variables with URLs
1. Go to your backend service settings
2. Update `CLIENT_URL` with the frontend URL
3. Go to your frontend service settings
4. Update `VITE_API_URL` with the backend URL
5. Save changes and redeploy both services

---

## Step 3: Post-Deployment Configuration

### 3.1 Seed Database with Reference Data
1. Go to your backend service in Render
2. Click "Shell" to open a terminal
3. Run: `npm run seed`
4. This will populate all game data (classes, backgrounds, items, etc.)

### 3.2 Test the Application
1. Visit your frontend URL
2. Register a new account
3. Create a character
4. Create a campaign
5. Test all features

### 3.3 Configure Email (Optional)
If you want actual email notifications:

#### Option A: Gmail
1. Enable 2-factor authentication
2. Generate App Password: https://myaccount.google.com/apppasswords
3. Use in environment variables:
   - EMAIL_HOST=smtp.gmail.com
   - EMAIL_USER=your-email@gmail.com
   - EMAIL_PASS=your-app-password

#### Option B: SendGrid
1. Sign up at https://sendgrid.com
2. Create API key
3. Use in environment variables:
   - EMAIL_HOST=smtp.sendgrid.net
   - EMAIL_USER=apikey
   - EMAIL_PASS=your-sendgrid-api-key

---

## Alternative Deployment: Railway.app

### Quick Deploy to Railway
1. Go to [Railway.app](https://railway.app/)
2. Click "Start a New Project"
3. Select "Deploy from GitHub repo"
4. Choose `Midnight_Nation_RPG`
5. Railway will auto-detect services
6. Add environment variables (same as above)
7. Deploy!

Railway advantages:
- Simpler setup
- Better free tier limits
- Automatic SSL
- Built-in database options

---

## Alternative Deployment: Single Server (Heroku-style)

If you prefer to deploy as a single service:

### Update package.json (root):
```json
"scripts": {
  "start": "cd server && npm start",
  "build": "cd client && npm install && npm run build",
  "heroku-postbuild": "npm run build"
}
```

### Deploy to Render as Web Service:
- Build Command: `npm run build`
- Start Command: `npm start`
- The server will automatically serve the built client files

---

## Monitoring & Maintenance

### Check Logs
- Go to Render dashboard
- Select your service
- Click "Logs" tab
- Monitor for errors

### Database Backups
- MongoDB Atlas automatically backs up M0 clusters
- For more control, upgrade to M2+ tier

### Updates
1. Push changes to GitHub
2. Render auto-deploys on push to main branch
3. Monitor deployment in Render dashboard

---

## Troubleshooting

### Backend won't start
- Check MongoDB connection string
- Verify all environment variables are set
- Check logs for specific errors

### Frontend shows API errors
- Verify VITE_API_URL is correct
- Check CORS settings in backend
- Ensure CLIENT_URL matches frontend URL

### Socket.io not connecting
- Verify WebSocket support is enabled
- Check that ports are correctly configured
- Ensure CORS allows your frontend domain

### Email notifications not working
- Check email credentials in environment variables
- Verify email service allows SMTP
- In development, emails log to console instead

---

## Cost Estimates

### Free Tier (Sufficient for development/small groups):
- MongoDB Atlas M0: FREE (512MB)
- Render.com Free tier: FREE (750 hours/month, sleeps after inactivity)
- **Total: $0/month**

### Paid Tier (Recommended for production):
- MongoDB Atlas M2: $9/month (2GB, backups)
- Render.com Standard: $7/month per service × 2 = $14/month
- **Total: ~$23/month**

---

## Security Checklist
- ✅ Strong JWT secret (auto-generated)
- ✅ HTTPS enabled (automatic on Render)
- ✅ Rate limiting configured
- ✅ Helmet.js security headers
- ✅ CORS restricted to specific domains
- ✅ MongoDB credentials secured
- ✅ Environment variables not in code

---

## Next Steps
1. Set up custom domain (optional)
2. Configure email notifications
3. Enable database backups
4. Set up monitoring/alerts
5. Invite users to test!

QTMAunOLIgjYzorM

mongodb+srv://midnight_admin:QTMAunOLIgjYzorM@midnightnation.odciv9i.mongodb.net/?appName=MidnightNation